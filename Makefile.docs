.PHONY: docs docs-serve docs-gen docs-validate help

# é»˜è®¤ç›®æ ‡
help:
	@echo "API æ–‡æ¡£ç®¡ç†å‘½ä»¤:"
	@echo "  make docs-serve     - å¯åŠ¨æ–‡æ¡£æœåŠ¡å™¨"
	@echo "  make docs-gen       - ç”Ÿæˆ Swagger æ–‡æ¡£ï¼ˆéœ€è¦ swag å·¥å…·ï¼‰"
	@echo "  make docs-validate  - éªŒè¯ OpenAPI è§„èŒƒ"
	@echo "  make docs-install   - å®‰è£…æ–‡æ¡£å·¥å…·"

# å¯åŠ¨æ–‡æ¡£æœåŠ¡å™¨
docs-serve:
	@echo "ğŸš€ å¯åŠ¨ API æ–‡æ¡£æœåŠ¡å™¨..."
	@cd docs && python3 -m http.server 8080 || python -m http.server 8080

# ç”Ÿæˆ Swagger æ–‡æ¡£ï¼ˆä½¿ç”¨ swag å·¥å…·ï¼‰
docs-gen:
	@echo "ğŸ“ ç”Ÿæˆ Swagger æ–‡æ¡£..."
	@if command -v swag >/dev/null 2>&1; then \
		swag init -g docs/docs.go -o docs/swagger --parseDependency --parseInternal; \
		echo "âœ… æ–‡æ¡£ç”Ÿæˆå®Œæˆ"; \
	else \
		echo "âŒ æœªæ‰¾åˆ° swag å·¥å…·ï¼Œè¯·å…ˆè¿è¡Œ: make docs-install"; \
		exit 1; \
	fi

# éªŒè¯ OpenAPI è§„èŒƒ
docs-validate:
	@echo "ğŸ” éªŒè¯ OpenAPI è§„èŒƒ..."
	@if command -v swagger >/dev/null 2>&1; then \
		swagger validate docs/swagger.yaml; \
	elif command -v openapi-generator-cli >/dev/null 2>&1; then \
		openapi-generator-cli validate -i docs/swagger.yaml; \
	else \
		echo "âš ï¸  æœªæ‰¾åˆ°éªŒè¯å·¥å…·ï¼Œè·³è¿‡éªŒè¯"; \
	fi

# å®‰è£…æ–‡æ¡£å·¥å…·
docs-install:
	@echo "ğŸ“¦ å®‰è£…æ–‡æ¡£å·¥å…·..."
	@echo "å®‰è£… swag..."
	@go install github.com/swaggo/swag/cmd/swag@latest
	@echo "âœ… å·¥å…·å®‰è£…å®Œæˆ"
	@echo ""
	@echo "å¯é€‰å·¥å…·:"
	@echo "  - Swagger CLI: npm install -g @apidevtools/swagger-cli"
	@echo "  - OpenAPI Generator: npm install -g @openapitools/openapi-generator-cli"

# å¿«æ·å‘½ä»¤
docs: docs-serve
